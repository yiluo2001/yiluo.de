<!DOCTYPE html>
<html>
<body>
    <h1>2048</h1>
    
    <div id="grid"></div>

    <div style="margin-top: 20px;">
        <button onclick="move('up')">W (Up)</button><br>
        <button onclick="move('left')">A (Left)</button>
        <button onclick="move('down')">S (Down)</button>
        <button onclick="move('right')">D (Right)</button>
    </div>

    <br>
    <button onclick="setupGame()">Restart</button>

    <script>
        let board = [];

        function setupGame() {
            const gridElement = document.getElementById('grid');
            gridElement.innerHTML = ""; 
            
            board = [
                [0, 0, 0, 0],
                [0, 0, 0, 0],
                [0, 0, 0, 0],
                [0, 0, 0, 0]
            ];

            for (let i = 0; i < 16; i++) {
                let cell = document.createElement('input');
                cell.id = "cell-" + i;
                cell.style.width = "40px";
                cell.style.height = "40px";
                cell.style.textAlign = "center";
                cell.readOnly = true;
                gridElement.appendChild(cell);// add tile to the wall
                if ((i + 1) % 4 === 0) gridElement.appendChild(document.createElement('br'));
            }

            addTile();
            addTile();
            updateUI();
        }

        function addTile() {
            let emptyCells = [];
            for (let r = 0; r < 4; r++) {
                for (let c = 0; c < 4; c++) {
                    if (board[r][c] === 0) {
                        emptyCells.push([r, c]);
                    }
                }
            }
            if (emptyCells.length > 0) {
                let randomIndex = Math.floor(Math.random() * emptyCells.length);
                let row = emptyCells[randomIndex][0];
                let col = emptyCells[randomIndex][1];
                board[row][col] = 2;
            }
        }

        function updateUI() {
            for (let r = 0; r < 4; r++) {
                for (let c = 0; c < 4; c++) {
                    let cellId = "cell-" + (r * 4 + c);
                    let value = board[r][c];
                    if (value === 0) {
                        document.getElementById(cellId).value = "";
                    } else {
                        document.getElementById(cellId).value = value;
                    }
                }
            }
        }

        function combine(row) {// another way is case by case of 1/2/3/4 non zero and sub cases ...
            let list = [];
            for (let i = 0; i < 4; i++) {
                if (row[i] !== 0) list.push(row[i]);
            }

            for (let i = 0; i < list.length - 1; i++) {
                if (list[i] === list[i + 1]) {
                    list[i] = list[i] * 2;
                    list[i + 1] = 0;
                }
            }

            let newList = [];
            for (let i = 0; i < list.length; i++) {
                if (list[i] !== 0) newList.push(list[i]);
            }

            while (newList.length < 4) {
                newList.push(0);
            }

            return newList;
        }

        function move(direction) {
            let oldBoardString = JSON.stringify(board);

            for (let i = 0; i < 4; i++) {
                if (direction === 'left') {
                    board[i] = combine(board[i]);
                } 
                else if (direction === 'right') {
                    let reversed = [board[i][3], board[i][2], board[i][1], board[i][0]];
                    let combined = combine(reversed);
                    board[i] = [combined[3], combined[2], combined[1], combined[0]];
                } 
                else if (direction === 'up') {
                    let column = [board[0][i], board[1][i], board[2][i], board[3][i]];
                    let combined = combine(column);
                    for (let r = 0; r < 4; r++) board[r][i] = combined[r];
                } 
                else if (direction === 'down') {
                    let column = [board[3][i], board[2][i], board[1][i], board[0][i]];
                    let combined = combine(column);
                    for (let r = 0; r < 4; r++) board[3 - r][i] = combined[r];
                }
            }

            if (oldBoardString !== JSON.stringify(board)) {
                addTile();
                updateUI();
            }
        }

        setupGame();
    </script>
</body>
</html>